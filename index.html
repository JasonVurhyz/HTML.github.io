<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 400px;
            width: 90%;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .startapp-value {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            word-break: break-all;
        }
        
        .info {
            margin-top: 30px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .debug {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.8em;
            text-align: left;
            font-family: monospace;
        }
        
        .button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ WebApp</h1>
        
        <div id="startapp-display">
            <div class="startapp-value" id="startapp-value">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>
        
        <div class="info">
            <p>–≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω —á–µ—Ä–µ–∑ startapp</p>
        </div>
        
        <button class="button" onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
        <button class="button" onclick="toggleDebug()">üîß Debug</button>
        
        <div class="debug" id="debug-info" style="display: none;">
            <strong>Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
            <span id="debug-content"></span>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = {};
            for (const [key, value] of urlParams) {
                params[key] = value;
            }
            return params;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è startapp –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
        function getStartAppValue() {
            let startappValue = null;
            let source = '';
            
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const urlParams = getUrlParams();
            if (urlParams.startapp) {
                startappValue = urlParams.startapp;
                source = 'URL –ø–∞—Ä–∞–º–µ—Ç—Ä';
            }
            
            // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp initData
            if (tg.initData) {
                const initDataParams = new URLSearchParams(tg.initData);
                if (initDataParams.get('start_param')) {
                    startappValue = initDataParams.get('start_param');
                    source = 'Telegram initData start_param';
                }
            }
            
            // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º hash –≤ URL (–¥–ª—è —Å–ª—É—á–∞–µ–≤ —Å #)
            if (window.location.hash) {
                const hash = window.location.hash.substring(1);
                const hashParams = new URLSearchParams(hash);
                if (hashParams.get('startapp')) {
                    startappValue = hashParams.get('startapp');
                    source = 'URL hash –ø–∞—Ä–∞–º–µ—Ç—Ä';
                }
            }
            
            return { value: startappValue, source: source };
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        function updateDisplay() {
            const result = getStartAppValue();
            const valueElement = document.getElementById('startapp-value');
            const debugElement = document.getElementById('debug-content');
            
            if (result.value) {
                valueElement.textContent = result.value;
                valueElement.style.background = 'rgba(46, 204, 113, 0.3)';
            } else {
                valueElement.textContent = '–ü–∞—Ä–∞–º–µ—Ç—Ä startapp –Ω–µ –Ω–∞–π–¥–µ–Ω';
                valueElement.style.background = 'rgba(231, 76, 60, 0.3)';
            }
            
            // Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            const debugInfo = {
                'StartApp –∑–Ω–∞—á–µ–Ω–∏–µ': result.value || '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                '–ò—Å—Ç–æ—á–Ω–∏–∫': result.source || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω',
                'URL': window.location.href,
                'URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã': JSON.stringify(getUrlParams(), null, 2),
                'Telegram initData': tg.initData || '–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                'User Agent': navigator.userAgent,
                '–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏': new Date().toLocaleString()
            };
            
            let debugText = '';
            for (const [key, value] of Object.entries(debugInfo)) {
                debugText += `${key}: ${value}\n`;
            }
            debugElement.textContent = debugText;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard() {
            const result = getStartAppValue();
            if (result.value) {
                navigator.clipboard.writeText(result.value).then(() => {
                    tg.showAlert('–ó–Ω–∞—á–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(() => {
                    tg.showAlert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                });
            } else {
                tg.showAlert('–ù–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è debug –ø–∞–Ω–µ–ª–∏
        function toggleDebug() {
            const debugPanel = document.getElementById('debug-info');
            if (debugPanel.style.display === 'none') {
                debugPanel.style.display = 'block';
            } else {
                debugPanel.style.display = 'none';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–Ω–∞ —Å–ª—É—á–∞–π –∏–∑–º–µ–Ω–µ–Ω–∏–π)
            setInterval(updateDisplay, 2000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Telegram WebApp
        tg.ready();
        
        // –ï—Å–ª–∏ WebApp –±—ã–ª –∑–∞–∫—Ä—ã—Ç/–æ—Ç–∫—Ä—ã—Ç
        tg.onEvent('viewportChanged', function() {
            updateDisplay();
        });
    </script>
</body>
</html>
